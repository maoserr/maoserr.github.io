<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<title>Mao Yu's kitchen - Win32 GUI program with console output</title>
	<link rel="stylesheet" type="text/css" href="/css/base.css" media="screen" />
	<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
	<meta name="description" content="Win32 programs have the unfortunate problem of being either GUI based or console based initially, one of the problem is that GUI programs cannot show console output by default, this shows how to re-enable console output and retrieve 'argc' and 'argv'." />
	<meta name="keywords" content="win32api, c programming, console programming" />
	<meta name="robots" content="index, follow" />
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="header">
	<ul>
		
		<li><a href="/" >Home</a></li>
		
			<li><a href="/projects/"
			>Projects</a></li>
		
			<li><a href="/resources/"
			>Resources</a></li>
		
			<li><a href="/notes/"
			 class="active">Notes</a></li>
		
	</ul>
	<a href="/"><img src="/images/logo.png" alt="Logo" id="logo"/></a>
	<h1>Mao Yu</h1>
	<span id="slogan">Casual code cook...</span>
</div>


<div class="colmask fullpage">
	<div class="col1_onecol">
		<h2>Win32 GUI program with console output</h2>
		<p>Win32 programs have the unfortunate problem of being either GUI based or console based initially, one of the problem is that GUI programs cannot show console output by default, this shows how to re-enable console output and retrieve 'argc' and 'argv'.</p>
		<p>This just re-enables 'stdout' and 'stderr'.  We first retrieves 'argv' and 'argc'.  Then if the current GUI was spawned from a console ('AttachConsole' returns true), we can re-open the 'std' handles, otherwise, no ugly console is spawned.  Remember to compile in GUI mode for this to work.</p>

<p>After that, you can just write a regular 'main' as if you're writing a console program.</p>

<p>One final thought, if you don't like the fact that GUI programs return immediately after spawning, use 'start /w' command to start your program, then the CMD prompt will wait until your program exits before resuming.</p>

<div class="highlight"><pre><span class="cp">#if defined(_WIN32)</span>
<span class="c1">// Win32 wrapper function for GUI mode</span>
<span class="kt">int</span> <span class="n">WINAPI</span> <span class="n">WinMain</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">,</span> <span class="n">HINSTANCE</span> <span class="n">hPrevInstance</span><span class="p">,</span>
        <span class="n">LPSTR</span> <span class="n">lpCmdLine</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nCmdShow</span><span class="p">){</span>
    <span class="k">extern</span> <span class="kt">char</span> <span class="o">**</span> <span class="n">__argv</span><span class="p">;</span>
    <span class="k">extern</span> <span class="kt">int</span> <span class="n">__argc</span><span class="p">;</span>

    <span class="c1">// This attaches a console to the parent process if it has a console</span>
    <span class="k">if</span><span class="p">(</span><span class="n">AttachConsole</span><span class="p">(</span><span class="n">ATTACH_PARENT_PROCESS</span><span class="p">)){</span>
        <span class="c1">// reopen stout handle as console window output</span>
        <span class="n">freopen</span><span class="p">(</span><span class="s">&quot;CONOUT$&quot;</span><span class="p">,</span><span class="s">&quot;wb&quot;</span><span class="p">,</span><span class="n">stdout</span><span class="p">);</span>
        <span class="c1">// reopen stderr handle as console window output</span>
        <span class="n">freopen</span><span class="p">(</span><span class="s">&quot;CONOUT$&quot;</span><span class="p">,</span><span class="s">&quot;wb&quot;</span><span class="p">,</span><span class="n">stderr</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">main</span><span class="p">(</span><span class="n">__argc</span><span class="p">,</span><span class="n">__argv</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>


<h3>References</h3>

<ol>
<li><a href="http://msdn.microsoft.com/en-us/library/ms681952(VS.85).aspx">AttachConsole on MSDN</a></li>
</ol>

	</div>
</div>
	<div id="footer">
		<p>Statically generated by <a href="http://nanoc.stoneship.org/">Nanoc</a></p>
	</div>
	<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-17478090-1']);
	_gaq.push(['_trackPageview']);
	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ?
			  'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>

</body>
</html>



